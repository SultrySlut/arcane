-- Auto Fishing Script with GUI
-- Original by Decta, GUI added

local players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

-- Variables
local isFishing = false
local destroy = false
local enable = false
local lastPos = Vector3.new(0,0,0)
local rodName = ""
local gotfish = false
local lastGotFish = false
local mainLoop = nil

-- Create GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AutoFishingGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui")

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 250, 0, 300)
MainFrame.Position = UDim2.new(0, 10, 0.5, -150)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1, -40, 1, 0)
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "ðŸŽ£ Auto Fishing"
TitleLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
TitleLabel.TextScaled = true
TitleLabel.Font = Enum.Font.SourceSansBold
TitleLabel.Parent = TitleBar

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextScaled = true
CloseButton.Font = Enum.Font.SourceSansBold
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Enable/Disable Button
local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0.8, 0, 0, 50)
ToggleButton.Position = UDim2.new(0.1, 0, 0, 60)
ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
ToggleButton.Text = "Start Fishing"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.TextScaled = true
ToggleButton.Font = Enum.Font.SourceSansBold
ToggleButton.Parent = MainFrame

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 8)
ToggleCorner.Parent = ToggleButton

-- Status Frame
local StatusFrame = Instance.new("Frame")
StatusFrame.Size = UDim2.new(0.9, 0, 0, 140)
StatusFrame.Position = UDim2.new(0.05, 0, 0, 125)
StatusFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
StatusFrame.BorderSizePixel = 0
StatusFrame.Parent = MainFrame

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(0, 8)
StatusCorner.Parent = StatusFrame

-- Status Title
local StatusTitle = Instance.new("TextLabel")
StatusTitle.Size = UDim2.new(1, 0, 0, 25)
StatusTitle.Position = UDim2.new(0, 0, 0, 5)
StatusTitle.BackgroundTransparency = 1
StatusTitle.Text = "Status"
StatusTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
StatusTitle.TextScaled = true
StatusTitle.Font = Enum.Font.SourceSansBold
StatusTitle.Parent = StatusFrame

-- Fishing Status
local FishingStatus = Instance.new("TextLabel")
FishingStatus.Size = UDim2.new(0.9, 0, 0, 20)
FishingStatus.Position = UDim2.new(0.05, 0, 0, 35)
FishingStatus.BackgroundTransparency = 1
FishingStatus.Text = "Fishing: Inactive"
FishingStatus.TextColor3 = Color3.fromRGB(200, 200, 200)
FishingStatus.TextScaled = true
FishingStatus.Font = Enum.Font.SourceSans
FishingStatus.TextXAlignment = Enum.TextXAlignment.Left
FishingStatus.Parent = StatusFrame

-- Rod Status
local RodStatus = Instance.new("TextLabel")
RodStatus.Size = UDim2.new(0.9, 0, 0, 20)
RodStatus.Position = UDim2.new(0.05, 0, 0, 60)
RodStatus.BackgroundTransparency = 1
RodStatus.Text = "Rod: Not Found"
RodStatus.TextColor3 = Color3.fromRGB(200, 200, 200)
RodStatus.TextScaled = true
RodStatus.Font = Enum.Font.SourceSans
RodStatus.TextXAlignment = Enum.TextXAlignment.Left
RodStatus.Parent = StatusFrame

-- Fish Detection Status
local FishDetection = Instance.new("TextLabel")
FishDetection.Size = UDim2.new(0.9, 0, 0, 20)
FishDetection.Position = UDim2.new(0.05, 0, 0, 85)
FishDetection.BackgroundTransparency = 1
FishDetection.Text = "Fish Bite: Waiting..."
FishDetection.TextColor3 = Color3.fromRGB(200, 200, 200)
FishDetection.TextScaled = true
FishDetection.Font = Enum.Font.SourceSans
FishDetection.TextXAlignment = Enum.TextXAlignment.Left
FishDetection.Parent = StatusFrame

-- Position Status
local PositionStatus = Instance.new("TextLabel")
PositionStatus.Size = UDim2.new(0.9, 0, 0, 20)
PositionStatus.Position = UDim2.new(0.05, 0, 0, 110)
PositionStatus.BackgroundTransparency = 1
PositionStatus.Text = "Position: Stable"
PositionStatus.TextColor3 = Color3.fromRGB(200, 200, 200)
PositionStatus.TextScaled = true
PositionStatus.Font = Enum.Font.SourceSans
PositionStatus.TextXAlignment = Enum.TextXAlignment.Left
PositionStatus.Parent = StatusFrame

-- Functions from original script
function getFishingRod(backpack)
    if not (backpack) then
        chars = players.LocalPlayer.Character:GetChildren()
    else
        chars = players.LocalPlayer.Backpack:GetChildren()
    end
    local rod = nil
    for index,child in pairs(chars) do
        if(string.match(child.Name,"Rod") == "Rod") then
            if not (backpack) then
                rodName = child.Name
            end
            if backpack and child.Name ~= rodName then continue end
            rod = child
            break
        end
    end
    if (rod) then  
        return rod
    end
end

function triggerRod()
    local rod = getFishingRod()
    if not (rod) then 
        return rod 
    end 
    local toolEvent = ReplicatedStorage.RS.Remotes.Misc:WaitForChild("ToolAction")
    toolEvent:FireServer(rod)
end

function startFishing()
    if not(isFishing) then
        triggerRod()
        isFishing = true
        return true
    else
        return false
    end
end

-- Update status display
local function updateStatus()
    -- Update fishing status
    if enable then
        FishingStatus.Text = "Fishing: Active"
        FishingStatus.TextColor3 = Color3.fromRGB(100, 255, 100)
    else
        FishingStatus.Text = "Fishing: Inactive"
        FishingStatus.TextColor3 = Color3.fromRGB(255, 100, 100)
    end
    
    -- Update rod status
    local rod = getFishingRod()
    if rod then
        RodStatus.Text = "Rod: " .. rod.Name
        RodStatus.TextColor3 = Color3.fromRGB(100, 255, 100)
    else
        rod = getFishingRod(true) -- Check backpack
        if rod then
            RodStatus.Text = "Rod: " .. rod.Name .. " (Backpack)"
            RodStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
        else
            RodStatus.Text = "Rod: Not Found"
            RodStatus.TextColor3 = Color3.fromRGB(255, 100, 100)
        end
    end
    
    -- Update fish detection
    if gotfish then
        FishDetection.Text = "Fish Bite: DETECTED!"
        FishDetection.TextColor3 = Color3.fromRGB(255, 255, 100)
    else
        FishDetection.Text = "Fish Bite: Waiting..."
        FishDetection.TextColor3 = Color3.fromRGB(200, 200, 200)
    end
end

-- Main fishing loop
local function fishingLoop()
    while wait(0.1) and not destroy do 
        if enable then
            local ply = players.LocalPlayer
            local pmodel = ply.Character
            
            if not pmodel then
                updateStatus()
                continue
            end
            
            local root = pmodel:FindFirstChild("HumanoidRootPart")
            if not root then
                updateStatus()
                continue
            end
            
            spawn(function()
                local GotFish = pmodel:FindFirstChild("FishBiteGoal")
                if GotFish and GotFish.value then
                    rodName = getFishingRod().Name
                    triggerRod()
                    gotfish = true
                end
            end)
            
            if(lastGotFish ~= gotfish and not (gotfish)) then
                -- unequip then equip the fishing rod 
                local rod = getFishingRod()
                if rod then
                    rod.Parent = ply.Backpack
                    wait(1)
                    rod.Parent = ply.Character
                    wait(1)
                    isFishing = true
                    triggerRod()
                end
            end
            
            lastGotFish = gotfish
            if(gotfish)then
                gotfish = false
            else
                startFishing()    
            end
            
            spawn(function()
                local rod = getFishingRod(true)
                if(rod)then
                    enable = false
                    isFishing = false
                end
            end)
            
            local currentPos = pmodel.HumanoidRootPart.Position
            if((lastPos - currentPos).magnitude > 1.9) then
                isFishing = false
                PositionStatus.Text = "Position: Moved!"
                PositionStatus.TextColor3 = Color3.fromRGB(255, 200, 100)
            else
                PositionStatus.Text = "Position: Stable"
                PositionStatus.TextColor3 = Color3.fromRGB(100, 255, 100)
            end
            lastPos = currentPos
        end
        
        updateStatus()
    end
end

-- Toggle button functionality
ToggleButton.MouseButton1Click:Connect(function()
    if not enable and getFishingRod() then
        triggerRod()
        enable = true
        isFishing = true
        ToggleButton.Text = "Stop Fishing"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
    else
        enable = false
        isFishing = false
        ToggleButton.Text = "Start Fishing"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
    end
end)

-- Close button functionality
CloseButton.MouseButton1Click:Connect(function()
    destroy = true
    enable = false
    isFishing = false
    wait(0.2)
    ScreenGui:Destroy()
end)

-- Make frame draggable
local dragging = false
local dragStart = nil
local startPos = nil

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

game:GetService("UserInputService").InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- Start the fishing loop
spawn(fishingLoop)

-- Initial status update
updateStatus()

-- Notification
game.StarterGui:SetCore("SendNotification", {
    Title = "Auto Fishing",
    Text = "GUI Loaded Successfully",
    Duration = 3
})